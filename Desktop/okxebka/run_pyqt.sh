#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ PyQt –≤–µ—Ä—Å–∏–∏ —Ç—Ä–µ–π–¥–µ—Ä–∞

echo "üöÄ –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–π–¥–µ—Ä–∞ (PyQt –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
if [ ! -d ".venv" ]; then
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    python3 -m venv .venv
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîß –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
source .venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -q --upgrade pip
pip install -q -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª
if [ ! -f "config.json" ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª config.json –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üìù –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á–∏ –≤ config.json"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ API –∫–ª—é—á–∏
if grep -q "YOUR_API_KEY_HERE" config.json; then
    echo "‚ö†Ô∏è  API –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!"
    echo "üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config.json –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ OKX API –∫–ª—é—á–∏"
    exit 1
fi

echo "‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤–æ!"
echo ""
echo "üéØ –ó–∞–ø—É—Å–∫ PyQt –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞..."
python3 main_pyqt.py 